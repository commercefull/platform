<%- include('../partials/header', { title: pageName }) %>

<div class="content-wrapper">
  <div class="content-header">
    <div class="container-fluid">
      <div class="row mb-2">
        <div class="col-sm-6">
          <h1 class="m-0"><i class="fas fa-building me-2"></i><%= pageName %></h1>
        </div>
        <div class="col-sm-6">
          <ol class="breadcrumb float-sm-end">
            <li class="breadcrumb-item"><a href="/admin">Dashboard</a></li>
            <li class="breadcrumb-item active">Business Information</li>
          </ol>
        </div>
      </div>
    </div>
  </div>

  <section class="content">
    <div class="container-fluid">
      <div class="row">
        <div class="col-lg-8">
          <form id="businessInfoForm">
            <div class="card">
              <div class="card-header">
                <h3 class="card-title"><i class="fas fa-file-contract me-2"></i>Legal Information</h3>
              </div>
              <div class="card-body">
                <% const businessInfo = settings.businessInfo ? (typeof settings.businessInfo === 'string' ? JSON.parse(settings.businessInfo) : settings.businessInfo) : {}; %>
                <div class="form-group mb-3">
                  <label class="form-label">Legal Business Name</label>
                  <input type="text" class="form-control" name="legalName" value="<%= businessInfo.legalName || '' %>" placeholder="Your Company, Inc.">
                  <small class="text-muted">The official registered name of your business</small>
                </div>
                <div class="form-group mb-3">
                  <label class="form-label">Tax ID / VAT Number</label>
                  <input type="text" class="form-control" name="taxId" value="<%= businessInfo.taxId || '' %>" placeholder="XX-XXXXXXX">
                  <small class="text-muted">Your business tax identification number</small>
                </div>
                <div class="form-group mb-3">
                  <label class="form-label">Business Registration Number</label>
                  <input type="text" class="form-control" name="registrationNumber" value="<%= businessInfo.registrationNumber || '' %>" placeholder="Registration number">
                  <small class="text-muted">Company registration or incorporation number</small>
                </div>
              </div>
            </div>

            <button type="submit" class="btn btn-primary btn-lg">
              <i class="fas fa-save me-2"></i>Save Business Information
            </button>
          </form>
        </div>
        <div class="col-lg-4">
          <!-- Quick Links -->
          <div class="card">
            <div class="card-header">
              <h3 class="card-title"><i class="fas fa-link me-2"></i>Settings</h3>
            </div>
            <div class="list-group list-group-flush">
              <a href="/admin/settings/store" class="list-group-item list-group-item-action">
                <i class="fas fa-store me-2"></i>Store Settings
              </a>
              <a href="/admin/settings/business" class="list-group-item list-group-item-action active">
                <i class="fas fa-building me-2"></i>Business Information
              </a>
              <a href="/admin/settings/localization" class="list-group-item list-group-item-action">
                <i class="fas fa-language me-2"></i>Localization
              </a>
              <a href="/admin/platform/configuration" class="list-group-item list-group-item-action">
                <i class="fas fa-cog me-2"></i>Platform Configuration
              </a>
            </div>
          </div>

          <!-- Info Card -->
          <div class="card card-outline card-info">
            <div class="card-header">
              <h3 class="card-title"><i class="fas fa-info-circle me-2"></i>Why This Matters</h3>
            </div>
            <div class="card-body">
              <p class="mb-2">Your business information is used for:</p>
              <ul class="mb-0">
                <li>Invoice generation</li>
                <li>Tax compliance</li>
                <li>Legal documentation</li>
                <li>Payment processing</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>

<script>
  document.getElementById('businessInfoForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const data = Object.fromEntries(formData);

    try {
      const response = await fetch('/admin/settings/business', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      const result = await response.json();
      if (result.success) {
        alert('Business information saved successfully');
      } else {
        alert('Error: ' + result.message);
      }
    } catch (error) {
      alert('Error: ' + error.message);
    }
  });
</script>

<%- include('../partials/footer') %>
